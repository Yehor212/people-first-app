import{j as a}from"./ui-vendor-KfDTkiq1.js";import{r as d}from"./react-vendor-IF54zLUS.js";import{c as w,bc as f,ag as c,l as y,g as m,u as Z,T as k,b1 as Y,h as $,bd as B,be as H,bf as G,bg as K,bh as V,a2 as O,bi as W,bj as _}from"./index-UwLtZcXk.js";import{S as J}from"./switch-C8I07Bc3.js";import{A as Q,m as ee}from"./animations-CRFQTM8M.js";import"./charts-PQtVkfgh.js";import"./backend-CX_x5MVl.js";/**
 * @license lucide-react v0.462.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const ae=w("Crown",[["path",{d:"M11.562 3.266a.5.5 0 0 1 .876 0L15.39 8.87a1 1 0 0 0 1.516.294L21.183 5.5a.5.5 0 0 1 .798.519l-2.834 10.246a1 1 0 0 1-.956.734H5.81a1 1 0 0 1-.957-.734L2.02 6.02a.5.5 0 0 1 .798-.519l4.276 3.664a1 1 0 0 0 1.516-.294z",key:"1vdc57"}],["path",{d:"M5 21h14",key:"11awu3"}]]);/**
 * @license lucide-react v0.462.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const te=w("EyeOff",[["path",{d:"M10.733 5.076a10.744 10.744 0 0 1 11.205 6.575 1 1 0 0 1 0 .696 10.747 10.747 0 0 1-1.444 2.49",key:"ct8e1f"}],["path",{d:"M14.084 14.158a3 3 0 0 1-4.242-4.242",key:"151rxh"}],["path",{d:"M17.479 17.499a10.75 10.75 0 0 1-15.417-5.151 1 1 0 0 1 0-.696 10.75 10.75 0 0 1 4.446-5.143",key:"13bj9a"}],["path",{d:"m2 2 20 20",key:"1ooewy"}]]);/**
 * @license lucide-react v0.462.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const re=w("Eye",[["path",{d:"M2.062 12.348a1 1 0 0 1 0-.696 10.75 10.75 0 0 1 19.876 0 1 1 0 0 1 0 .696 10.75 10.75 0 0 1-19.876 0",key:"1nclc0"}],["circle",{cx:"12",cy:"12",r:"3",key:"1v7zrd"}]]);/**
 * @license lucide-react v0.462.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const se=w("Medal",[["path",{d:"M7.21 15 2.66 7.14a2 2 0 0 1 .13-2.2L4.4 2.8A2 2 0 0 1 6 2h12a2 2 0 0 1 1.6.8l1.6 2.14a2 2 0 0 1 .14 2.2L16.79 15",key:"143lza"}],["path",{d:"M11 12 5.12 2.2",key:"qhuxz6"}],["path",{d:"m13 12 5.88-9.8",key:"hbye0f"}],["path",{d:"M8 7h8",key:"i86dvs"}],["circle",{cx:"12",cy:"17",r:"5",key:"qbz8iq"}],["path",{d:"M12 18v-2h-.5",key:"fawc4q"}]]);async function ne(r,e=10){const s=await f(),i={weekly:"weekly_xp",monthly:"monthly_xp",streak:"current_streak"}[r],{data:n,error:p}=await c.from("leaderboards").select("*").eq("opt_in",!0).order(i,{ascending:!1}).limit(e);return p?(y.error("[Leaderboard] Failed to fetch leaderboard:",p),[]):(n||[]).map((o,j)=>({id:o.id,userId:o.user_id,displayName:o.display_name||"Zen User",weeklyXp:o.weekly_xp||0,monthlyXp:o.monthly_xp||0,allTimeXp:o.all_time_xp||0,currentStreak:o.current_streak||0,longestStreak:o.longest_streak||0,optIn:o.opt_in,rank:j+1,isCurrentUser:o.user_id===s}))}async function M(){const r=await f();if(!r)return null;const{data:e,error:s}=await c.from("leaderboards").select("*").eq("user_id",r).single();return s?(s.code==="PGRST116"||y.error("[Leaderboard] Failed to fetch user entry:",s),null):{id:e.id,userId:e.user_id,displayName:e.display_name||"Zen User",weeklyXp:e.weekly_xp||0,monthlyXp:e.monthly_xp||0,allTimeXp:e.all_time_xp||0,currentStreak:e.current_streak||0,longestStreak:e.longest_streak||0,optIn:e.opt_in,isCurrentUser:!0}}async function le(){if(!await f())return{weeklyRank:null,monthlyRank:null,streakRank:null,totalParticipants:0};const e=await M();if(!e||!e.optIn)return{weeklyRank:null,monthlyRank:null,streakRank:null,totalParticipants:0};const{count:s}=await c.from("leaderboards").select("*",{count:"exact",head:!0}).eq("opt_in",!0),{count:i}=await c.from("leaderboards").select("*",{count:"exact",head:!0}).eq("opt_in",!0).gt("weekly_xp",e.weeklyXp),{count:n}=await c.from("leaderboards").select("*",{count:"exact",head:!0}).eq("opt_in",!0).gt("monthly_xp",e.monthlyXp),{count:p}=await c.from("leaderboards").select("*",{count:"exact",head:!0}).eq("opt_in",!0).gt("current_streak",e.currentStreak);return{weeklyRank:(i??0)+1,monthlyRank:(n??0)+1,streakRank:(p??0)+1,totalParticipants:s??0}}async function oe(r){const e=await f();if(!e)return!1;const i=r.trim().slice(0,20).replace(/[^a-zA-Z0-9 _-]/g,"")||"Zen User",{error:n}=await c.from("leaderboards").upsert({user_id:e,display_name:i,opt_in:!0},{onConflict:"user_id"});return n?(y.error("[Leaderboard] Failed to opt in:",n),!1):!0}async function ie(){const r=await f();if(!r)return!1;const{error:e}=await c.from("leaderboards").update({opt_in:!1}).eq("user_id",r);return e?(y.error("[Leaderboard] Failed to opt out:",e),!1):!0}async function de(r){const e=await f();if(!e)return!1;const s=r.trim().slice(0,20).replace(/[^a-zA-Z0-9 _-]/g,"")||"Zen User",{error:i}=await c.from("leaderboards").update({display_name:s}).eq("user_id",e);return i?(y.error("[Leaderboard] Failed to update display name:",i),!1):!0}function ce(r){switch(r){case 1:return"ðŸ¥‡";case 2:return"ðŸ¥ˆ";case 3:return"ðŸ¥‰";default:return""}}function ue(r){const e=["th","st","nd","rd"],s=r%100;return r+(e[(s-20)%10]||e[s]||e[0])}let l=null;function me(){l||(l=document.createElement("div"),l.setAttribute("aria-live","polite"),l.setAttribute("aria-atomic","true"),l.setAttribute("role","status"),l.className="sr-only",l.style.cssText=`
    position: absolute;
    width: 1px;
    height: 1px;
    padding: 0;
    margin: -1px;
    overflow: hidden;
    clip: rect(0, 0, 0, 0);
    white-space: nowrap;
    border: 0;
  `,document.body.appendChild(l))}function A(r,e="polite"){l||me(),l&&(l.setAttribute("aria-live",e),l.textContent="",requestAnimationFrame(()=>{l&&(l.textContent=r)}))}const q=d.forwardRef(({className:r,type:e,...s},i)=>a.jsx("input",{type:e,className:m("flex h-10 w-full rounded-md border border-input bg-background px-3 py-2 text-base ring-offset-background file:border-0 file:bg-transparent file:text-sm file:font-medium file:text-foreground placeholder:text-muted-foreground focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-ring focus-visible:ring-offset-2 disabled:cursor-not-allowed disabled:opacity-50 md:text-sm",r),ref:i,...s}));q.displayName="Input";function we({trigger:r}){const{t:e}=Z(),[s,i]=d.useState(!1),[n,p]=d.useState("weekly"),[o,j]=d.useState([]),[pe,T]=d.useState(null),[x,X]=d.useState(null),[N,L]=d.useState(!1),[S,R]=d.useState(null),[b,C]=d.useState(""),[g,v]=d.useState(!1),I=[{type:"weekly",label:e.weekly||"Weekly",icon:a.jsx(k,{className:"w-4 h-4"})},{type:"monthly",label:e.monthly||"Monthly",icon:a.jsx(Y,{className:"w-4 h-4"})},{type:"streak",label:e.streak||"Streak",icon:a.jsx($,{className:"w-4 h-4"})}],h=d.useCallback(async()=>{L(!0),R(null);try{const[t,u,P]=await Promise.all([ne(n,10),M(),le()]);j(t),T(u),X(P),u&&(C(u.displayName),v(u.optIn))}catch(t){y.error("Failed to load leaderboard:",t),R(e.leaderboardLoadError||"Failed to load leaderboard")}finally{L(!1)}},[n,e.leaderboardLoadError]);d.useEffect(()=>{s&&h()},[s,h]);const z=async t=>{t?await oe(b||"Zen User")&&(v(!0),_.success(e.leaderboardOptedIn||"You joined the leaderboard!"),A("You joined the leaderboard"),h()):await ie()&&(v(!1),_.success(e.leaderboardOptedOut||"You left the leaderboard"),A("You left the leaderboard"))},U=async()=>{if(!b.trim())return;await de(b)&&(_.success(e.nameUpdated||"Display name updated!"),h())},F=t=>{switch(n){case"weekly":return t.weeklyXp;case"monthly":return t.monthlyXp;case"streak":return t.currentStreak}},D=()=>{switch(n){case"weekly":case"monthly":return"XP";case"streak":return e.days||"days"}},E=()=>{if(!x)return null;switch(n){case"weekly":return x.weeklyRank;case"monthly":return x.monthlyRank;case"streak":return x.streakRank}};return a.jsxs(B,{open:s,onOpenChange:i,children:[a.jsx(H,{asChild:!0,children:r||a.jsxs("button",{className:"flex items-center gap-2 px-4 py-2 bg-secondary rounded-lg hover:bg-secondary/80 transition-colors","aria-label":e.leaderboard||"Leaderboard",children:[a.jsx(k,{className:"w-5 h-5 text-primary"}),a.jsx("span",{className:"font-medium",children:e.leaderboard||"Leaderboard"})]})}),a.jsxs(G,{side:"bottom",className:"h-[85vh] rounded-t-3xl","aria-label":e.leaderboard||"Leaderboard",children:[a.jsx(K,{className:"pb-4",children:a.jsxs(V,{className:"flex items-center gap-2 text-xl",children:[a.jsx(k,{className:"w-6 h-6 text-primary"}),e.leaderboard||"Leaderboard"]})}),a.jsx("div",{role:"tablist","aria-label":e.leaderboardType||"Leaderboard type",className:"flex gap-2 mb-4",children:I.map(t=>a.jsxs("button",{role:"tab","aria-selected":n===t.type,"aria-controls":`leaderboard-${t.type}`,onClick:()=>p(t.type),className:m("flex-1 flex items-center justify-center gap-2 py-2 px-3 rounded-lg font-medium transition-all",n===t.type?"bg-primary text-primary-foreground":"bg-secondary text-muted-foreground hover:bg-secondary/80"),children:[t.icon,a.jsx("span",{className:"text-sm",children:t.label})]},t.type))}),a.jsxs("div",{className:"bg-secondary/50 rounded-xl p-4 mb-4",children:[a.jsxs("div",{className:"flex items-center justify-between mb-3",children:[a.jsxs("div",{className:"flex items-center gap-2",children:[g?a.jsx(re,{className:"w-4 h-4 text-primary"}):a.jsx(te,{className:"w-4 h-4 text-muted-foreground"}),a.jsx("span",{className:"font-medium text-sm",children:e.showOnLeaderboard||"Show on leaderboard"})]}),a.jsx(J,{checked:g,onCheckedChange:z,"aria-label":e.showOnLeaderboard||"Show on leaderboard"})]}),g&&a.jsx("div",{className:"flex gap-2",children:a.jsx(q,{value:b,onChange:t=>C(t.target.value),placeholder:e.displayName||"Display name",maxLength:20,className:"flex-1",onBlur:U,onKeyDown:t=>t.key==="Enter"&&U()})}),g&&E()&&a.jsxs("div",{className:"mt-3 flex items-center gap-2 text-sm text-muted-foreground",children:[a.jsx(se,{className:"w-4 h-4"}),a.jsxs("span",{children:[e.yourRank||"Your rank",": ",a.jsx("strong",{className:"text-foreground",children:ue(E())}),x&&` / ${x.totalParticipants}`]})]})]}),a.jsx("div",{id:`leaderboard-${n}`,role:"tabpanel","aria-label":`${I.find(t=>t.type===n)?.label} leaderboard`,className:"space-y-2 overflow-y-auto max-h-[45vh] pb-4",children:N?a.jsx("div",{className:"flex items-center justify-center py-12",children:a.jsx(O,{className:"w-6 h-6 animate-spin text-muted-foreground"})}):S?a.jsxs("div",{className:"text-center py-12",children:[a.jsx(k,{className:"w-12 h-12 mx-auto mb-3 text-destructive/50"}),a.jsx("p",{className:"text-destructive mb-3",children:S}),a.jsx("button",{onClick:h,className:"px-4 py-2 bg-primary text-primary-foreground rounded-lg hover:bg-primary/90 transition-colors",children:e.retry||"Retry"})]}):o.length===0?a.jsxs("div",{className:"text-center py-12 text-muted-foreground",children:[a.jsx(W,{className:"w-12 h-12 mx-auto mb-3 opacity-50"}),a.jsx("p",{children:e.noParticipants||"No participants yet"}),a.jsx("p",{className:"text-sm mt-1",children:e.beFirst||"Be the first to join!"})]}):a.jsx(Q,{children:o.map((t,u)=>a.jsxs(ee.div,{initial:{opacity:0,x:-20},animate:{opacity:1,x:0},exit:{opacity:0,x:20},transition:{delay:u*.05},className:m("flex items-center gap-3 p-3 rounded-xl transition-all",t.isCurrentUser?"bg-primary/10 ring-1 ring-primary/30":"bg-secondary/50"),children:[a.jsx("div",{className:m("w-8 h-8 flex items-center justify-center rounded-full font-bold text-sm",t.rank===1&&"bg-yellow-500/20 text-yellow-600",t.rank===2&&"bg-gray-300/30 text-gray-500",t.rank===3&&"bg-amber-600/20 text-amber-700",(t.rank??0)>3&&"bg-secondary text-muted-foreground"),children:ce(t.rank??0)||t.rank}),a.jsxs("div",{className:"flex-1 min-w-0",children:[a.jsxs("div",{className:"flex items-center gap-1",children:[a.jsx("span",{className:m("font-medium truncate",t.isCurrentUser&&"text-primary"),children:t.displayName}),t.isCurrentUser&&a.jsx("span",{className:"text-xs text-primary",children:"(you)"}),t.rank===1&&a.jsx(ae,{className:"w-4 h-4 text-yellow-500"})]}),n==="streak"&&t.longestStreak>t.currentStreak&&a.jsxs("span",{className:"text-xs text-muted-foreground",children:[e.best||"Best",": ",t.longestStreak," ",e.days||"days"]})]}),a.jsxs("div",{className:"text-right",children:[a.jsx("span",{className:m("font-bold",t.rank===1&&"text-yellow-600",t.rank===2&&"text-gray-500",t.rank===3&&"text-amber-700",(t.rank??0)>3&&"text-foreground"),children:F(t).toLocaleString()}),a.jsx("span",{className:"text-xs text-muted-foreground ml-1",children:D()})]})]},t.id))})}),a.jsx("button",{onClick:h,disabled:N,className:"absolute top-4 right-12 p-2 rounded-lg hover:bg-secondary transition-colors","aria-label":e.refresh||"Refresh",children:a.jsx(O,{className:m("w-5 h-5",N&&"animate-spin")})})]})]})}export{we as Leaderboard,we as default};
